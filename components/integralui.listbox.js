/*
  filename: integralui.listbox.js
  version : 21.3.0
  Copyright Â© 2016-2021 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
import{c as css,h as html}from"../external/lit-element.js";import{c as classMap}from"../external/class-map.js";import{s as styleMap}from"../external/style-map.js";import{IntegralUITheme}from"./integralui.enums.js";import"./integralui.base.js";import IntegralUIBaseList from"./integralui.base.list.js";import"./integralui.scrollbar.js";import{iuiListItemDefaultStyle}from"../styles/integralui.listitem.style.js";import{iuiListItemOfficeStyle}from"../themes/office/integralui.listitem.office.js";import{iuiListItemMidnightStyle}from"../themes/midnight/integralui.listitem.midnight.js";import{iuiListBoxDefaultStyle}from"../styles/integralui.listbox.style.js";import{iuiListBoxOfficeStyle}from"../themes/office/integralui.listbox.office.js";import{iuiListBoxMidnightStyle}from"../themes/midnight/integralui.listbox.midnight.js";class IntegralUIListBox extends IntegralUIBaseList{_init(){super._init();this._currentControlStyleSettings=iuiListBoxDefaultStyle;this._currentItemStyleSettings=iuiListItemDefaultStyle;this._currentItemThemeSettings=css``;this._generalClassName="iui-listbox";this._itemClassName="iui-listitem";this._itemContentClassName=this._itemClassName+"-content";this._updateOptions();this._initStyle();this._updateData()}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback();this._removeDropMark();if(this._updateTimer)clearTimeout(this._updateTimer);this._rt()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i)}static get properties(){return{}}_addItemToCurrentList(t){t.type="item";if(!t[this._options.dataFields.id])t[this._options.dataFields.id]=this._commonService.getUniqueId();if(this._isItemAllowed(t))this._currentList.push({data:t})}loadData(t,e){this._processLoadData(t,null,e)}_updateCurrentList(){this._currentList.length=0;let t=this._dataService.getList();if(t){this._applySorting(t);t.map(t=>this._addItemToCurrentList(t))}}_updateScrollItemList(){this._resetScrollItemList();this._scrollItemList.length=0;this.update();let t=1;for(let e=this._currentIndex;e<this._currentList.length&&e<this._currentIndex+this._visibleRange;e++,t++){let i=this._currentList[e],s={clickPos:{x:0,y:0},data:i.data,index:e-this._currentIndex,inlineStyle:this._getItemInlineStyle(i),style:{},tabIndex:t};this._updateItemStyle(s);this._scrollItemList.push(s)}}_updateBlockSize(){this._blockSize={width:this._contentElem.offsetWidth,height:this._contentElem.offsetHeight}}_getContentSize(){return this._contentElem?{width:this._contentElem.offsetWidth,height:this._contentElem.offsetHeight}:{width:0,height:0}}_processUpdateLayout(){let t=this;return new Promise(e=>{if(t._allowUpdate){t._resetLayoutTimer();t.updateTimer=setTimeout(function(){t._updateCurrentList();t._clientRect={width:t._elemRef.clientWidth,height:t._elemRef.clientHeight};t._updateScrollItemList();t.update();let i=setTimeout(function(){t._updateItemElems();t._updateBlockSize();t._avgItemHeight=0;let s=t._getItemElemList();if(s&&s.length>0){let e=0;for(let t=0;t<s.length;t++)e+=s[t].offsetHeight;t._avgItemHeight=Math.floor(e/s.length)}t._updateScrollSize();t._updateVisibleRange();t._updateScrollItemList();t.refresh();t._invokeEvent("updateComplete");t._updateItemElems();clearTimeout(i);e()},1);clearTimeout(t.updateTimer)},1)}})}_getControlStyle(){let t={cursor:this._ctrlCursor,overflow:this.virtualMode?"hidden":"auto"};if(this._ctrlSize.width>0)t.width=this._ctrlSize.width+"px";if(this._ctrlSize.height>0)t.height=this._ctrlSize.height+"px";return t}_resetRefresh(){if(this._refreshTimer)clearTimeout(this._refreshTimer);this._refreshTimer=null}refresh(t){this._resetRefresh();if(!1!==this.virtualMode){this._updateControlClass();this._scrollItemList.map(t=>this._updateItemStyle(t))}this.update();this._updateReferences()}_updateThemeSettings(t){this._currentThemeSettings=css``;this._currentItemThemeSettings=css``;switch(t){case IntegralUITheme.Office:this._currentThemeSettings.cssText=this._commonService.replaceAll(iuiListBoxOfficeStyle.cssText,"../icons",this._currentResourcePath);this._currentItemThemeSettings.cssText=this._commonService.replaceAll(iuiListItemOfficeStyle.cssText,"../icons",this._currentResourcePath);break;case IntegralUITheme.Midnight:this._currentThemeSettings.cssText=this._commonService.replaceAll(iuiListBoxMidnightStyle.cssText,"../icons",this._currentResourcePath);this._currentItemThemeSettings.cssText=this._commonService.replaceAll(iuiListItemMidnightStyle.cssText,"../icons",this._currentResourcePath);break;default:this._currentThemeSettings.cssText="";this._currentItemThemeSettings.cssText=""}}firstUpdated(t){let e=this;e._updateReferences();setTimeout(function(){e._isHoverTemplatePresent=e.itemHoverTemplate?!0:!1;e._isSelectedTemplatePresent=e.itemSelectTemplate?!0:!1;e.updateLayout()},1)}updated(t){t.forEach((t,e)=>{});this._updateFocusItem()}render(){return html`             <style>                 ${this._currentControlStyleSettings}                 ${this._currentItemStyleSettings}                 ${this._currentThemeSettings}                 ${this._currentItemThemeSettings}                 ${this._currentCustomStyle}             </style>             <div data-ctrl="listbox" class=${classMap(this._getControlClass())} style=${styleMap(this._getControlStyle())} @DOMMouseScroll="${t=>this._processMouseWheel(t)}" @mousewheel="${t=>this._processMouseWheel(t)}" @mouseenter="${t=>this._onCtrlMouseEnter(t)}" @mouseleave="${t=>this._onCtrlMouseLeave(t)}" @mousemove="${t=>this._onCtrlMouseMove(t)}" @dragenter="${t=>this._ctrlDragEnter(t)}" @dragleave="${t=>this._ctrlDragLeave(t)}" @dragover="${t=>this._ctrlDragOver(t)}" @drop="${t=>this._ctrlDragDrop(t)}" @dragend="${t=>this._ctrlDragEnd(t)}" @scroll="${t=>this._onScroll(t)}">                 <ul id="content" @touchstart="${t=>this._ctrlTouchStart(t)}" @touchend="${t=>this._ctrlTouchEnd(t)}" style=${styleMap({width:this._contentSize.width+"px",height:this._contentSize.height+"px",margin:0,padding:0})}>                     ${this._scrollItemList.map((t,e)=>html`                         <li data-item class=${classMap({"iui-listitem-animate":this.allowAnimation,"iui-listitem-animate-enter-suspended":this.allowAnimation&&t.data===this._hoverItem})} style=${styleMap(t.inlineStyle)} @mouseenter="${e=>this._itemMouseEnter(e,t)}" @mouseleave="${e=>this._itemMouseLeave(e,t)}">                             <div class=${classMap(t.style.general)} @click="${e=>this._itemClickEvent(e,t)}" @dblclick="${e=>this._itemDblClickEvent(e,t)}" @contextmenu="${e=>this._itemRightClickEvent(e,t)}" @mousedown="${e=>this._itemMouseDown(e,t)}" @mousemove="${e=>this._itemMouseMove(e,t)}" @mouseup="${e=>this._itemMouseUp(e,t)}" draggable="true" @dragstart="${e=>this._itemDragStart(e,t)}" @dragover="${i=>this._itemDragOver(i,t,e,!0)}" @drop="${e=>this._itemDragDrop(e,t)}" @touchstart="${e=>this._itemTouchStart(e,t)}" @touchmove="${e=>this._itemTouchMove(e,t)}" @touchend="${e=>this._itemTouchEnd(e,t)}">                                 <div data-item-content class=${classMap(t.style.content)} tabindex="${t.tabIndex}" @focus="${e=>this._itemGotFocus(t)}" @blur="${e=>this._itemLostFocus(t)}" @keydown="${e=>this._itemKeyDown(e,t)}" @keypress="${e=>this._itemKeyPress(e,t)}" @keyup="${e=>this._itemKeyUp(e,t)}">                                     ${this._getItemTemplate(t.data)}                                 </div>                             </div>                         </li>                     `)}                 </ul>                 ${this._isHoverTemplatePresent&&!this._isUpdateActive&&this._hoverItemObj&&this._isContentAllowed(this._hoverItemObj.data,"hover")?html`<div class="iui-listbox-block iui-listbox-block-hover" style=${styleMap({left:this._blockHoverRect.left+"px",top:this._blockHoverRect.top+"px",height:this._blockHoverRect.height+"px",width:this._blockHoverRect.width+"px"})}>                             <div style=${styleMap({height:this._blockHoverRect.height+"px"})} @mousemove="${t=>this._hoverBlockMouseMove(t)}" @mouseleave="${t=>this._hoverBlockMouseLeave(t)}">                                 ${this._getItemTemplate(this._hoverItemObj.data,"hover")}                             </div>                         </div>`:html``}                 ${this._isSelectedTemplatePresent&&!this._isUpdateActive?this._currentSelectedItems.map((t,e)=>html`<span>                             ${this._isContentAllowed(t,"select")?html`<div class="iui-listbox-block iui-listbox-block-select" style=${styleMap(this._getSelectBlockRect(e))}>                                     <div style=${styleMap({height:this._blockSelectHeight+"px"})}>                                         ${this._getItemTemplate(t,"select")}                                     </div>                                 </div>`:html``}                             </span>`):html``}                 ${this.isVerScrollVisible()?html`<iui-scrollbar id="ver-scroll" .enabled="${this.enabled}" .value="${this._currentScrollPos.y}" .max="${this._maxScrollPos.y}" .largeChange="${this._scrollLargeChange.y}" .height="${this._scrollBarSize.height}" .theme="${this._currentTheme}" @mouseenter="${t=>this._scrollMouseEnter(t)}" @valueChanged="${t=>this._onVerticalScrollChanged(t)}" @scrollStart="${t=>this._onVerticalScrollStart(t)}" @scrollEnd="${t=>this._onVerticalScrollEnd(t)}"></iui-scrollbar>`:html``}                 ${this.isHorScrollVisible()?html`<iui-scrollbar id="hor-scroll" .enabled="${this.enabled}" orientation="Horizontal" .value="${this._currentScrollPos.x}" .max="${this._maxScrollPos.x}" .width="${this._scrollBarSize.width}" .theme="${this._currentTheme}" @mouseenter="${t=>this._scrollMouseEnter(t)}" @valueChanged="${t=>this._onHorizontalScrollChanged(t)}" @scrollStart="${t=>this._onHorizontalScrollStart(t)}" @scrollEnd="${t=>this._onHorizontalScrollEnd(t)}"></iui-scrollbar>`:html``}                 ${this.isVerScrollVisible()&&this.isHorScrollVisible()?html`<div class="iui-scrollbar-corner" style="position:absolute;right:0;bottom:0;width:16px;height:16px;"></div>`:html``}             </div>         `}_updateControlStyleSettings(t){this._currentControlStyleSettings=css``;this._currentControlStyleSettings.cssText=this._commonService.replaceAll(iuiListBoxDefaultStyle.cssText,"../icons",t);this._currentItemStyleSettings=css``;this._currentItemStyleSettings.cssText=this._commonService.replaceAll(iuiListItemDefaultStyle.cssText,"../icons",t)}_updateReferences(){this._elemRef=this.shadowRoot.querySelector("div[data-ctrl=listbox]");this._contentElem=this.shadowRoot.querySelector("#content")}}window.customElements.define("iui-listbox",IntegralUIListBox);export default IntegralUIListBox;